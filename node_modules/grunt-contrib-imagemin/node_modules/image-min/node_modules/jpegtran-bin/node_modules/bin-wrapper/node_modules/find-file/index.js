'use strict';

var fs = require('fs');
var path = require('path');

/**
 * Search for a file in an array of paths dirs, excludes, global
 *
 * @param {String} name
 * @param {String|Array} dirs
 * @param {String|Array} excludes
 * @param {Boolean} global
 * @api public
 */

module.exports = function (name, opts) {
    var file;

    opts.path = Array.isArray(opts.path) ? opts.path : [opts.path];
    opts.exclude = Array.isArray(opts.exclude) ? opts.exclude : [opts.exclude];
    opts.global = opts.global !== false;

    if (opts.global) {
        opts.path = opts.path.concat(process.env.PATH.split(path.delimiter));
    }

    file = opts.path.map(function (dir) {
        if (dir && opts.exclude.indexOf(dir) === -1) {
            return path.join(dir, name);
        }
    }).filter(fs.existsSync);

    if (!file.length) {
        return null;
    }

    return file;
};
